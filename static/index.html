<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API Testing</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
    h1 { margin-top: 0; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
    button { padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid #d1d5db; background: #f9fafb; cursor: pointer; }
    button:hover { background: #f3f4f6; }
    pre { background: #0b1021; color: #e5e7eb; padding: 1rem; border-radius: 8px; overflow: auto; }
    input { padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 8px; width: 5rem; }
    .row { display: flex; gap: 0.5rem; align-items: center; }
  </style>
</head>
<body>
  <h1>API Testing Frontend</h1>
  <p>Call your Flask API endpoints below.</p>

  <div class="card">
    <h3>Health</h3>
    <button onclick="call('/healthz')">GET /healthz</button>
    <pre id="health"></pre>
  </div>

  <div class="card">
    <h3>Ping</h3>
    <button onclick="call('/api/ping')">GET /api/ping</button>
    <pre id="ping"></pre>
  </div>

  <div class="card">
    <h3>Echo (POST JSON)</h3>
    <button onclick="echo()">POST /api/echo</button>
    <pre id="echo"></pre>
  </div>

  <div class="card">
    <h3>Calc</h3>
    <div class="row">
      <label>A <input id="a" type="number" value="5" /></label>
      <label>B <input id="b" type="number" value="7" /></label>
      <button onclick="calc()">GET /api/calc</button>
    </div>
    <pre id="calc"></pre>
  </div>

  <div class="card">
    <h3>External API (uses env vars)</h3>
    <button onclick="call('/api/external')">GET /api/external</button>
    <pre id="external"></pre>
  </div>

  <script>
    async function call(path) {
      const res = await fetch(path);
      const text = await res.text();
      const id = path.split("/").pop() || "health";
      document.getElementById(id).textContent = format(text);
    }

    async function echo() {
      const res = await fetch("/api/echo", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ hello: "world", time: new Date().toISOString() })
      });
      document.getElementById("echo").textContent = format(await res.text());
    }

    async function calc() {
      const a = document.getElementById("a").value;
      const b = document.getElementById("b").value;
      const res = await fetch(`/api/calc?a=${encodeURIComponent(a)}&b=${encodeURIComponent(b)}`);
      document.getElementById("calc").textContent = format(await res.text());
    }

    function format(text) {
      try { return JSON.stringify(JSON.parse(text), null, 2); }
      catch { return text; }
    }
  </script>
</body>
</html>
